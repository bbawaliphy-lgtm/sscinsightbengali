<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSC INSIGHT BENGALI - Mock Test Series</title>
    
    <!-- PWA Manifest & Meta -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#020617">
    <link rel="apple-touch-icon" href="logo.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Added Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        body {
            font-family: 'Poppins', 'Noto Sans Bengali', sans-serif;
            background: #020617;
            color: #e2e8f0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* --- Animated Background --- */
        .area {
            background: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
            width: 100%;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
        }

        .circles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        .circles li {
            position: absolute;
            display: block;
            list-style: none;
            width: 20px;
            height: 20px;
            background: rgba(16, 185, 129, 0.15); /* Green tint */
            animation: animate 25s linear infinite;
            bottom: -150px;
            border-radius: 50%;
            filter: blur(1px);
        }

        .circles li:nth-child(1) { left: 25%; width: 80px; height: 80px; animation-delay: 0s; }
        .circles li:nth-child(2) { left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
        .circles li:nth-child(3) { left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
        .circles li:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; }
        .circles li:nth-child(5) { left: 65%; width: 20px; height: 20px; animation-delay: 0s; }
        .circles li:nth-child(6) { left: 75%; width: 110px; height: 110px; animation-delay: 3s; }
        .circles li:nth-child(7) { left: 35%; width: 150px; height: 150px; animation-delay: 7s; }
        .circles li:nth-child(8) { left: 50%; width: 25px; height: 25px; animation-delay: 15s; animation-duration: 45s; }
        .circles li:nth-child(9) { left: 20%; width: 15px; height: 15px; animation-delay: 2s; animation-duration: 35s; }
        .circles li:nth-child(10) { left: 85%; width: 150px; height: 150px; animation-delay: 0s; animation-duration: 11s; }

        @keyframes animate {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; border-radius: 0; }
            100% { transform: translateY(-1000px) rotate(720deg); opacity: 0; border-radius: 50%; }
        }

        /* --- Utilities --- */
        .bengali-text { font-family: 'Noto Sans Bengali', sans-serif; }
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        .slide-up { animation: slideUp 0.7s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: rgba(30, 41, 59, 0.5); border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        /* Glassmorphism */
        .glass-panel {
            background: rgba(15, 23, 42, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .glass-card-accent {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.7) 0%, rgba(15, 23, 42, 0.8) 100%);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .glass-card-accent:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-color: rgba(34, 197, 94, 0.3);
        }

        /* Mentor Image Ring */
        .mentor-ring {
            background: conic-gradient(from 0deg, transparent 0%, #eab308 20%, transparent 40%);
            animation: rotate 4s linear infinite;
        }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* YouTube Card Hover */
        .yt-card:hover .play-icon { transform: scale(1.1); }
        .yt-card:hover img { transform: scale(1.05); }

        /* Website Mockup Styles */
        .mock-browser {
            background: #0f172a;
            border-radius: 12px;
            border: 1px solid #334155;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 8px 10px -6px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            position: relative;
        }
        .browser-header {
            background: #1e293b;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #334155;
        }
        .dots { display: flex; gap: 6px; margin-right: 12px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; }
        .dot-red { background: #ef4444; }
        .dot-yellow { background: #eab308; }
        .dot-green { background: #22c55e; }
        .address-bar {
            background: #0f172a;
            border-radius: 4px;
            flex-grow: 1;
            height: 20px;
            font-size: 10px;
            color: #64748b;
            display: flex;
            align-items: center;
            padding: 0 8px;
        }

        /* Toast Notification Styles */
        #social-proof {
            transform: translateX(-150%);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #social-proof.show {
            transform: translateX(0);
        }

        /* Confetti */
        .confetti-piece {
            position: absolute;
            width: 10px; height: 10px;
            background: #ffd300;
            top: 0; opacity: 0;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); }
        }

        /* Slider Styles */
        .slider-container {
            width: 100%;
            aspect-ratio: 16 / 9;
            position: relative;
            overflow: hidden;
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        .slide.active { opacity: 1; }

        /* Input Styles */
        .glass-input {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            backdrop-filter: blur(10px);
        }
        .glass-input:focus {
            outline: none;
            border-color: #22c55e;
            box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2);
        }
        
        /* Test Selection Card Hover */
        .test-card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }

        /* Locked Test Styling */
        .locked-test {
            opacity: 0.5;
            filter: grayscale(0.8);
            cursor: not-allowed;
            position: relative;
        }
        .locked-test::after {
            content: '\f023'; /* FontAwesome Lock */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: rgba(255,255,255,0.2);
        }
        .unlocked-test {
            opacity: 1;
            filter: grayscale(0);
            cursor: pointer;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Background Animation -->
    <div class="area">
        <ul class="circles">
            <li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
        </ul>
    </div>

    <!-- Knowledge Trivia Pop-up -->
    <div id="social-proof" class="fixed bottom-4 left-4 z-50 bg-slate-900/95 backdrop-blur-md border border-slate-600 p-4 rounded-xl shadow-2xl flex items-start gap-4 max-w-sm border-l-4 border-l-yellow-500">
        <div class="w-10 h-10 rounded-full bg-yellow-500/20 flex items-center justify-center text-yellow-400 shrink-0 border border-slate-700 mt-1">
            <i class="fas fa-lightbulb"></i>
        </div>
        <div>
            <p class="text-sm font-bold text-white leading-snug bengali-text" id="proof-text">Did you know?</p>
            <p class="text-[10px] text-slate-400 mt-1 font-semibold uppercase tracking-wider">Grammar Tip</p>
        </div>
    </div>

    <!-- Header -->
    <header class="glass-panel sticky top-0 z-50 border-b border-slate-700/50">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <!-- Logo -->
                <div class="w-10 h-10 md:w-12 md:h-12 flex-shrink-0 bg-slate-900 rounded-xl flex items-center justify-center overflow-hidden border border-green-500/50 shadow-lg group">
                    <img src="logo.png" alt="Logo" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300" onerror="this.onerror=null; this.parentNode.innerHTML='<i class=\'fas fa-book-open text-green-500 text-xl\'></i>'">
                </div>
                <div>
                    <h1 class="text-base md:text-lg font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-300 leading-tight tracking-wide">SSC INSIGHT BENGALI</h1>
                    <p class="text-[10px] md:text-xs text-slate-400 font-semibold tracking-wider uppercase">by Dyutimala Datta</p>
                </div>
            </div>
            <div class="text-right hidden sm:block">
                <a href="https://www.youtube.com/@SSCINSIGHTBENGALI?sub_confirmation=1" target="_blank" class="px-4 py-1.5 rounded-full bg-red-600 hover:bg-red-700 transition-colors border border-red-500 text-xs font-bold text-white flex items-center inline-block">
                    <i class="fab fa-youtube mr-2 text-sm"></i> Subscribe
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow flex items-center justify-center p-4 relative z-10 w-full">
        
        <!-- Start Screen (Dashboard Layout) -->
        <div id="start-screen" class="max-w-7xl w-full slide-up space-y-8">
            
            <!-- Promo Slider Section -->
            <div class="glass-panel rounded-3xl p-6 relative overflow-hidden border border-green-500/30">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <!-- Slider -->
                    <div class="slider-container bg-slate-900 shadow-xl" id="image-slider">
                        <img src="display1.png" class="slide active" alt="Promo Slide">
                        <img src="display2.png" class="slide" alt="Promo Slide">
                        <img src="display3.png" class="slide" alt="Promo Slide">
                        <img src="display4.png" class="slide" alt="Promo Slide">
                        <img src="display5.png" class="slide" alt="Promo Slide">
                        <img src="display6.png" class="slide" alt="Promo Slide">
                    </div>
                    
                    <!-- Content -->
                    <div class="text-center md:text-left">
                        <span class="inline-block px-3 py-1 bg-green-500/10 text-green-400 text-xs font-bold rounded-full mb-3 border border-green-500/20">LIVE PRACTICE BATCH</span>
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Boost Your Preparation</h2>
                        <p class="text-slate-300 text-sm mb-6 bengali-text leading-relaxed">
                            SSC CGL এর জন্য প্রতিদিন আমাদের LIVE ক্লাস চলছে! একদম FREE। দ্যুতিমালা দিদির সাথে নিয়মিত প্র্যাকটিস করে নিজেকে আরো তৈরি করো। ৫০০+ Aspirants already যুক্ত হয়ে আছে। 
                        </p>
                        <a href="https://chat.whatsapp.com/HX6nMksgdE57GSRkrNmE5l" target="_blank" class="inline-flex items-center justify-center bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-8 rounded-xl shadow-lg shadow-green-900/30 transition-all transform hover:scale-105 group">
                            <i class="fab fa-whatsapp text-xl mr-2"></i> 
                            <span>Join WhatsApp Group</span>
                        </a>
                        <p class="text-[10px] text-slate-500 mt-3">*Click to join the official community group</p>
                    </div>
                </div>
            </div>

            <!-- Top Section: Mentor & Test Info -->
            <div class="grid grid-cols-1 md:grid-cols-12 gap-6 items-stretch">
                
                <!-- Mentor Profile Section (Left / Top) -->
                <div class="md:col-span-5 lg:col-span-4 flex">
                    <div class="glass-card-accent rounded-3xl p-6 w-full flex flex-col items-center text-center relative overflow-hidden">
                        <!-- Decorative bg glow -->
                        <div class="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-yellow-500/10 to-transparent pointer-events-none"></div>
                        
                        <div class="relative w-32 h-32 mb-4">
                            <!-- Animated Ring -->
                            <div class="absolute inset-[-4px] rounded-full mentor-ring blur-sm"></div>
                            <div class="absolute inset-0 rounded-full bg-slate-900 border-2 border-yellow-500/30 overflow-hidden">
                                <img src="Dyuti.png" alt="Dyutimala Datta" class="w-full h-full object-cover" onerror="this.src='https://ui-avatars.com/api/?name=Dyutimala+Datta&background=0F172A&color=EAB308&size=128&font-size=0.35'">
                            </div>
                            <div class="absolute bottom-0 right-0 bg-yellow-500 text-slate-900 text-xs font-bold px-2 py-0.5 rounded-full border-2 border-slate-800 shadow-lg">
                                Mentor
                            </div>
                        </div>

                        <h3 class="text-2xl font-bold text-white mb-1">Dyutimala Datta</h3>
                        <p class="text-yellow-400 text-xs font-bold mb-4 px-2">Cracked SSC CGL 2018 (1st attempt) & 2019 (2nd attempt)</p>

                        <div class="w-full space-y-3 text-left bg-slate-900/40 p-4 rounded-xl border border-slate-700/50">
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 rounded-lg bg-yellow-500/10 flex items-center justify-center flex-shrink-0 text-yellow-500 mt-1">
                                    <i class="fas fa-graduation-cap text-sm"></i>
                                </div>
                                <div>
                                    <p class="text-xs text-slate-400 uppercase font-bold">Education</p>
                                    <p class="text-sm text-slate-200">M.Sc. Physics (1st Class)</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 rounded-lg bg-blue-500/10 flex items-center justify-center flex-shrink-0 text-blue-400 mt-1">
                                    <i class="fas fa-briefcase text-sm"></i>
                                </div>
                                <div>
                                    <p class="text-xs text-slate-400 uppercase font-bold">Selected As</p>
                                    <p class="text-sm text-slate-200">Scientific Officer in CWC</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 rounded-lg bg-purple-500/10 flex items-center justify-center flex-shrink-0 text-purple-400 mt-1">
                                    <i class="fas fa-star text-sm"></i>
                                </div>
                                <div>
                                    <p class="text-xs text-slate-400 uppercase font-bold">Other Success</p>
                                    <p class="text-sm text-slate-200">MTS 2019, Phase 7 & 8</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Test Selection Section -->
                <div class="md:col-span-7 lg:col-span-8 flex flex-col justify-center">
                    <div class="glass-panel rounded-3xl p-6 md:p-8 shadow-2xl relative overflow-hidden h-full flex flex-col">
                        <!-- Background glow effect -->
                        <div class="absolute -right-20 -top-20 w-64 h-64 bg-green-500/10 blur-[80px] rounded-full pointer-events-none"></div>

                        <div class="relative z-10">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-6">
                                <div>
                                    <h2 class="text-2xl md:text-3xl font-extrabold text-white mb-1 tracking-tight">
                                        Mock Test <span class="text-blue-500">Series</span>
                                    </h2>
                                    <p class="text-sm text-slate-400">Enter your name to unlock the tests.</p>
                                </div>
                                <div class="w-full md:w-auto mt-4 md:mt-0">
                                    <input type="text" id="student-name" placeholder="Your Full Name" class="glass-input w-full md:w-64 p-3 rounded-xl text-sm transition-all border-slate-600 focus:border-blue-500" onkeyup="toggleTestButtons()">
                                </div>
                            </div>

                            <!-- Test Grid (Scrollable if many) -->
                            <div class="max-h-[400px] overflow-y-auto custom-scroll pr-2">
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="test-grid">
                                    <!-- Test 01 -->
                                    <button onclick="redirectToQuiz('test1')" id="btn-test1" disabled class="test-card-hover locked-test text-left bg-slate-800/50 hover:bg-slate-800 border border-slate-700 hover:border-green-500 p-4 rounded-xl transition-all duration-300 group">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-green-400 font-bold text-sm">TEST 01</span>
                                            <span class="text-[10px] bg-slate-900 text-slate-400 px-2 py-0.5 rounded border border-slate-700">25 Qs</span>
                                        </div>
                                        <h3 class="text-base font-bold text-white mb-1 group-hover:text-green-400 transition-colors">Synonyms (Start with A)</h3>
                                        <div class="w-full h-1 bg-slate-700 rounded-full mt-2 overflow-hidden"><div class="h-full bg-green-500 w-full"></div></div>
                                    </button>

                                    <!-- Test 02 -->
                                    <button onclick="redirectToQuiz('test2')" id="btn-test2" disabled class="test-card-hover locked-test text-left bg-slate-800/50 hover:bg-slate-800 border border-slate-700 hover:border-blue-500 p-4 rounded-xl transition-all duration-300 group">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-blue-400 font-bold text-sm">TEST 02</span>
                                            <span class="text-[10px] bg-slate-900 text-slate-400 px-2 py-0.5 rounded border border-slate-700">25 Qs</span>
                                        </div>
                                        <h3 class="text-base font-bold text-white mb-1 group-hover:text-blue-400 transition-colors">Mixed Synonyms (B-Z)</h3>
                                        <div class="w-full h-1 bg-slate-700 rounded-full mt-2 overflow-hidden"><div class="h-full bg-blue-500 w-full"></div></div>
                                    </button>

                                    <!-- Placeholder loop for tests 3 to 30 will be generated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Website & App Integration Section -->
            <div id="eco-widget" class="glass-panel rounded-3xl overflow-hidden border border-slate-700/50 relative">
                <!-- (Same content as before) -->
                <div class="absolute top-0 right-0 w-1/2 h-full bg-gradient-to-l from-blue-600/10 to-transparent pointer-events-none"></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 p-6 md:p-8 items-center">
                    <!-- Text Content -->
                    <div class="z-10">
                        <span class="text-blue-400 text-xs font-bold tracking-widest uppercase mb-2 inline-block">Learning Ecosystem</span>
                        <h2 class="text-3xl font-bold text-white mb-4">Access Premium & Free Courses</h2>
                        <p class="text-slate-300 mb-6 leading-relaxed">
                            Take your preparation to the next level with our dedicated website and mobile app. Get access to comprehensive study materials, video courses, and exclusive test series.
                        </p>
                        
                        <div class="flex flex-wrap gap-3 mb-6">
                            <span class="px-3 py-1 bg-slate-800 rounded-lg text-xs text-slate-300 border border-slate-700 flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Free Zero-Price Courses</span>
                            <span class="px-3 py-1 bg-slate-800 rounded-lg text-xs text-slate-300 border border-slate-700 flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Premium Batches</span>
                            <span class="px-3 py-1 bg-slate-800 rounded-lg text-xs text-slate-300 border border-slate-700 flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> PDF Notes</span>
                        </div>

                        <div class="flex flex-col sm:flex-row gap-4">
                            <a href="https://sscinsightbengali.akamai.net.in/zero-price-courses" target="_blank" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-6 rounded-xl transition-all shadow-lg hover:shadow-blue-500/25 flex items-center justify-center">
                                <i class="fas fa-globe mr-2"></i> Visit Website
                            </a>
                            <a href="https://play.google.com/store/apps/details?id=com.ejrlhf.xecukh&pcampaignid=web_share" target="_blank" class="bg-slate-800 hover:bg-slate-700 text-white font-bold py-3 px-6 rounded-xl border border-slate-600 transition-all flex items-center justify-center">
                                <i class="fab fa-android mr-2 text-green-400"></i> Download App
                            </a>
                        </div>
                    </div>

                    <!-- Visualisation (Mock Browser) -->
                    <div class="relative z-10 hidden md:block">
                        <div class="mock-browser transform rotate-1 hover:rotate-0 transition-transform duration-500">
                            <div class="browser-header">
                                <div class="dots">
                                    <div class="dot dot-red"></div>
                                    <div class="dot dot-yellow"></div>
                                    <div class="dot dot-green"></div>
                                </div>
                                <div class="address-bar">
                                    <i class="fas fa-lock text-[8px] mr-1 text-green-500"></i> sscinsightbengali.akamai.net.in
                                </div>
                            </div>
                            <div class="bg-slate-900 p-6 h-48 flex flex-col justify-center items-center relative overflow-hidden">
                                <div class="absolute inset-0 bg-gradient-to-br from-slate-800 to-slate-900 opacity-50"></div>
                                <div class="grid grid-cols-2 gap-3 w-full max-w-xs relative z-10">
                                    <div class="bg-slate-700/50 h-20 rounded-lg border border-slate-600 p-3 flex flex-col justify-between hover:bg-slate-700 transition-colors">
                                        <div class="w-8 h-8 rounded bg-blue-500/20 flex items-center justify-center text-blue-400"><i class="fas fa-video"></i></div>
                                        <div class="h-2 w-16 bg-slate-500 rounded"></div>
                                    </div>
                                    <div class="bg-slate-700/50 h-20 rounded-lg border border-slate-600 p-3 flex flex-col justify-between hover:bg-slate-700 transition-colors">
                                        <div class="w-8 h-8 rounded bg-green-500/20 flex items-center justify-center text-green-400"><i class="fas fa-file-pdf"></i></div>
                                        <div class="h-2 w-12 bg-slate-500 rounded"></div>
                                    </div>
                                    <div class="bg-slate-700/50 h-20 rounded-lg border border-slate-600 p-3 flex flex-col justify-between hover:bg-slate-700 transition-colors col-span-2">
                                        <div class="flex items-center justify-between">
                                            <div class="w-8 h-8 rounded bg-purple-500/20 flex items-center justify-center text-purple-400"><i class="fas fa-graduation-cap"></i></div>
                                            <div class="px-2 py-0.5 bg-yellow-500/20 text-yellow-500 text-[8px] rounded font-bold">PREMIUM</div>
                                        </div>
                                        <div class="h-2 w-24 bg-slate-500 rounded mt-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- YouTube Showcase Section (Hidden ID moved to generic container for cloning) -->
            <div id="yt-widget" class="glass-panel rounded-3xl p-6 md:p-8 border border-slate-700/50 relative overflow-hidden">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-6">
                    <div class="flex items-center space-x-4 mb-4 sm:mb-0">
                        <div class="w-12 h-12 rounded-full bg-red-600 flex items-center justify-center shadow-lg">
                            <i class="fab fa-youtube text-2xl text-white"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-white">SSC INSIGHT BENGALI</h3>
                            <p class="text-xs text-slate-400 uppercase font-bold tracking-wider">Latest Classes</p>
                        </div>
                    </div>
                    <a href="https://www.youtube.com/@SSCINSIGHTBENGALI?sub_confirmation=1" target="_blank" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2.5 px-6 rounded-full transition-transform transform hover:scale-105 shadow-lg flex items-center">
                        <i class="fas fa-bell mr-2 animate-bounce"></i> Subscribe for More
                    </a>
                </div>
                <!-- YouTube Videos Grid -->
                 <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <a href="http://www.youtube.com/watch?v=Tp2WvaQz57I" target="_blank" class="yt-card group block bg-slate-900/50 rounded-xl overflow-hidden border border-slate-700 hover:border-red-500/50 transition-all shadow-lg">
                        <div class="relative overflow-hidden aspect-video">
                            <img src="https://img.youtube.com/vi/Tp2WvaQz57I/mqdefault.jpg" alt="Video Thumbnail" class="w-full h-full object-cover transition-transform duration-500">
                            <div class="absolute inset-0 bg-black/40 group-hover:bg-black/20 transition-colors flex items-center justify-center">
                                <div class="play-icon w-12 h-12 bg-red-600 rounded-full flex items-center justify-center shadow-lg transform transition-transform duration-300 group-hover:scale-110">
                                    <i class="fas fa-play text-white ml-1"></i>
                                </div>
                            </div>
                        </div>
                        <div class="p-4">
                            <h4 class="text-sm font-semibold text-white line-clamp-2 group-hover:text-red-400 transition-colors">BEST BOOKS For SSC 2025 Preparation In BENGALI</h4>
                        </div>
                    </a>
                    <a href="http://www.youtube.com/watch?v=BDSmrTwIluk" target="_blank" class="yt-card group block bg-slate-900/50 rounded-xl overflow-hidden border border-slate-700 hover:border-red-500/50 transition-all shadow-lg">
                        <div class="relative overflow-hidden aspect-video">
                            <img src="https://img.youtube.com/vi/BDSmrTwIluk/mqdefault.jpg" alt="Video Thumbnail" class="w-full h-full object-cover transition-transform duration-500">
                            <div class="absolute inset-0 bg-black/40 group-hover:bg-black/20 transition-colors flex items-center justify-center">
                                <div class="play-icon w-12 h-12 bg-red-600 rounded-full flex items-center justify-center shadow-lg transform transition-transform duration-300 group-hover:scale-110">
                                    <i class="fas fa-play text-white ml-1"></i>
                                </div>
                            </div>
                        </div>
                        <div class="p-4">
                            <h4 class="text-sm font-semibold text-white line-clamp-2 group-hover:text-red-400 transition-colors">500+ Words Vocab Marathon Session</h4>
                        </div>
                    </a>
                    <a href="http://www.youtube.com/watch?v=aTDXXeNVn3M" target="_blank" class="yt-card group block bg-slate-900/50 rounded-xl overflow-hidden border border-slate-700 hover:border-red-500/50 transition-all shadow-lg">
                         <div class="relative overflow-hidden aspect-video">
                            <img src="https://img.youtube.com/vi/aTDXXeNVn3M/mqdefault.jpg" alt="Video Thumbnail" class="w-full h-full object-cover transition-transform duration-500">
                            <div class="absolute inset-0 bg-black/40 group-hover:bg-black/20 transition-colors flex items-center justify-center">
                                <div class="play-icon w-12 h-12 bg-red-600 rounded-full flex items-center justify-center shadow-lg transform transition-transform duration-300 group-hover:scale-110">
                                    <i class="fas fa-play text-white ml-1"></i>
                                </div>
                            </div>
                        </div>
                        <div class="p-4">
                            <h4 class="text-sm font-semibold text-white line-clamp-2 group-hover:text-red-400 transition-colors">SSC CGL 2024 Strategy</h4>
                        </div>
                    </a>
                    <a href="http://www.youtube.com/watch?v=F51jOhOfXqA" target="_blank" class="yt-card group block bg-slate-900/50 rounded-xl overflow-hidden border border-slate-700 hover:border-red-500/50 transition-all shadow-lg">
                         <div class="relative overflow-hidden aspect-video">
                            <img src="https://img.youtube.com/vi/F51jOhOfXqA/mqdefault.jpg" alt="Video Thumbnail" class="w-full h-full object-cover transition-transform duration-500">
                            <div class="absolute inset-0 bg-black/40 group-hover:bg-black/20 transition-colors flex items-center justify-center">
                                <div class="play-icon w-12 h-12 bg-red-600 rounded-full flex items-center justify-center shadow-lg transform transition-transform duration-300 group-hover:scale-110">
                                    <i class="fas fa-play text-white ml-1"></i>
                                </div>
                            </div>
                        </div>
                        <div class="p-4">
                            <h4 class="text-sm font-semibold text-white line-clamp-2 group-hover:text-red-400 transition-colors">How to Prepare Maths</h4>
                        </div>
                    </a>
                </div>
            </div>
            
        </div>

        <!-- Result Screen (Enhanced) -->
        <div id="result-screen" class="hidden w-full max-w-7xl space-y-8 fade-in slide-up">
            
            <!-- Confetti Container -->
            <div id="confetti-container" class="fixed inset-0 pointer-events-none z-50 overflow-hidden"></div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                
                <!-- Left Column: Detailed Analysis (Pie Chart, Comparisons, Motivation) -->
                <div class="lg:col-span-5 space-y-6">
                    
                    <!-- Main Score Card with Pie Chart -->
                    <div class="glass-panel rounded-3xl p-6 relative border border-slate-600/50 text-center">
                        <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-green-500/5 to-transparent pointer-events-none rounded-3xl"></div>
                        
                        <h2 class="text-2xl font-bold text-white mb-4"><i class="fas fa-chart-pie text-green-400 mr-2"></i>Performance Analysis</h2>
                        
                        <!-- Canvas for Chart -->
                        <div class="relative w-48 h-48 mx-auto mb-6">
                            <canvas id="scoreChart"></canvas>
                        </div>

                        <!-- Data Grid -->
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <div class="bg-slate-800/50 p-3 rounded-xl border border-slate-700">
                                <p class="text-slate-500 text-[10px] uppercase font-bold tracking-widest">SSC Score</p>
                                <p class="text-2xl font-bold text-yellow-400" id="ssc-score">0.0</p>
                            </div>
                            <div class="bg-slate-800/50 p-3 rounded-xl border border-slate-700">
                                <p class="text-slate-500 text-[10px] uppercase font-bold tracking-widest">Rank %</p>
                                <p class="text-2xl font-bold text-blue-400" id="percentile-display">--</p>
                            </div>
                        </div>
                        
                        <!-- Navigation -->
                         <div class="flex gap-2">
                            <button onclick="shareTest()" class="flex-1 bg-green-600 hover:bg-green-500 text-white font-bold py-2.5 rounded-lg text-sm transition-all">
                                <i class="fab fa-whatsapp mr-1"></i> Share
                            </button>
                            <button onclick="window.location.href='index.html'" class="flex-1 bg-slate-800 hover:bg-slate-700 text-white font-bold py-2.5 rounded-lg border border-slate-600 text-sm transition-all">
                                <i class="fas fa-home mr-1"></i> Home
                            </button>
                        </div>
                    </div>

                    <!-- Comparison Card -->
                    <div class="glass-panel rounded-2xl p-5 border border-purple-500/30">
                        <h3 class="text-sm font-bold text-purple-400 mb-4 uppercase tracking-wider"><i class="fas fa-crown mr-1"></i> vs Topper</h3>
                        <div class="space-y-4">
                            <!-- Score Compare -->
                            <div>
                                <div class="flex justify-between text-xs text-slate-400 mb-1">
                                    <span>Your Score</span>
                                    <span>Topper's Score</span>
                                </div>
                                <div class="h-2 bg-slate-800 rounded-full flex overflow-hidden">
                                    <div class="bg-blue-500 h-full" id="bar-your-score" style="width: 0%"></div>
                                    <div class="bg-slate-700 h-full flex-grow"></div> <!-- Spacer -->
                                </div>
                                <div class="relative h-2 -mt-2">
                                     <div class="absolute right-0 top-0 bg-yellow-500 h-2 rounded-full opacity-70" style="width: 100%"></div>
                                </div>
                            </div>
                            
                            <!-- Time Compare -->
                            <div class="flex items-center justify-between bg-slate-800/50 p-3 rounded-lg">
                                <div class="text-center">
                                    <p class="text-[10px] text-slate-500">Your Time</p>
                                    <p class="text-sm font-bold text-white" id="time-taken">0m 0s</p>
                                </div>
                                <div class="text-xs text-slate-500">vs</div>
                                <div class="text-center">
                                    <p class="text-[10px] text-slate-500">Topper's Time</p>
                                    <p class="text-sm font-bold text-yellow-400" id="topper-time">--</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bengali Motivation & Share -->
                    <div class="glass-panel rounded-2xl p-6 border-l-4 border-l-pink-500 bg-gradient-to-r from-pink-900/10 to-transparent">
                        <div id="motivation-box" class="mb-4">
                            <h3 class="text-xl font-bold text-white bengali-text mb-2" id="motivation-title">দারুণ করেছো!</h3>
                            <p class="text-sm text-slate-300 bengali-text" id="motivation-text">তোমার এই স্কোর প্রমাণ করে তুমি সঠিক পথেই আছো।</p>
                        </div>
                        <p class="text-xs text-slate-400 bengali-text mb-3 border-t border-slate-700/50 pt-3">
                            আমাদের এই উদ্যোগটি তোমার বন্ধুদের সাথে শেয়ার করো। বেশি প্রতিযোগী থাকলে তোমার নিজের অবস্থান আরও ভালো করে বুঝতে পারবে।
                        </p>
                        <button onclick="shareTest()" class="w-full py-2 bg-slate-800 hover:bg-slate-700 text-pink-400 border border-pink-500/30 rounded-lg text-xs font-bold transition-all">
                            <i class="fas fa-share-alt mr-1"></i> বন্ধুদের জানাও (Share Initiative)
                        </button>
                    </div>

                </div>

                <!-- Right Column: Leaderboard -->
                <div class="lg:col-span-7">
                    <div class="glass-panel rounded-3xl p-6 md:p-8 h-full flex flex-col border border-slate-600/50">
                        <div class="flex justify-between items-end mb-6">
                            <div>
                                <h3 class="text-2xl font-bold text-white flex items-center gap-2"><i class="fas fa-list-ol text-green-400"></i> Leaderboard</h3>
                                <p class="text-xs text-slate-400 mt-1" id="leaderboard-title">Live Rankings (Test 01)</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-slate-500 uppercase font-bold">Participants</p>
                                <p class="text-xl font-bold text-white" id="participant-count-display">--</p>
                            </div>
                        </div>

                        <div class="bg-slate-900/50 rounded-2xl border border-slate-700 flex-grow overflow-hidden flex flex-col">
                            <div class="p-3 border-b border-slate-700 grid grid-cols-12 text-xs font-bold text-slate-500 uppercase tracking-wider">
                                <div class="col-span-2 text-center">Rank</div>
                                <div class="col-span-6">Student</div>
                                <div class="col-span-2 text-center">Time</div>
                                <div class="col-span-2 text-right">Score</div>
                            </div>
                            <div class="overflow-y-auto custom-scroll flex-grow" id="leaderboard-list">
                                <!-- Dynamic Content -->
                                <div class="p-4 text-center text-slate-500 text-sm">Loading rankings...</div>
                            </div>
                            <!-- Current User Fixed at Bottom -->
                            <div class="p-4 bg-green-900/20 border-t border-green-500/30 grid grid-cols-12 items-center text-sm" id="user-rank-row">
                                <div class="col-span-2 text-center font-bold text-green-400" id="user-rank">#--</div>
                                <div class="col-span-6 font-bold text-white truncate" id="user-name-display">You</div>
                                <div class="col-span-2 text-center text-slate-300" id="user-time-display">--</div>
                                <div class="col-span-2 text-right font-bold text-yellow-400" id="user-final-score">0.0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Placeholders for widgets moved to end screen -->
            <div id="end-screen-promos" class="space-y-8"></div>
        </div>

    </main>

    <footer class="bg-slate-950 py-6 border-t border-slate-900 text-center text-slate-500 text-xs relative z-10">
        <p>&copy; 2025 SSC INSIGHT BENGALI by <span class="text-slate-400 font-semibold">DYUTIMALA DATTA</span>. All rights reserved.</p>
    </footer>

    <button id="install-btn" ...>
        <i class="fas fa-download animate-bounce"></i>
        <span>Install App</span>
    </button>
    
    <script>
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
            if (!isStandalone) {
                installBtn.classList.remove('hidden');
            }
        });

        installBtn.addEventListener('click', async () => {
            installBtn.classList.add('hidden');
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                deferredPrompt = null;
            }
        });

        window.addEventListener('appinstalled', () => {
            console.log('PWA was installed');
            installBtn.classList.add('hidden');
        });
    </script>
    
    <!-- Service Worker Registration Script -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, onSnapshot, doc, getDoc } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDZLWUMldpxj6K_tabkjmS6qcAYPy97FdI",
            authDomain: "sscinsight-test-portal.firebaseapp.com",
            projectId: "sscinsight-test-portal",
            storageBucket: "sscinsight-test-portal.firebasestorage.app",
            messagingSenderId: "92985848140",
            appId: "1:92985848140:web:130acb96effb1b0c58dfe9"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let currentAppId = 'ssc-insight-synonyms-test-01'; 
        let currentUserId = null;
        let unsubscribeLeaderboard = null;
        let activeTestsMap = {};

        // Generate placeholders for Tests 3-30
        const testGrid = document.getElementById('test-grid');
        for (let i = 3; i <= 30; i++) {
            const btn = document.createElement('button');
            const testId = `test${i}`;
            const paddedId = i.toString().padStart(2, '0');
            btn.id = `btn-${testId}`;
            btn.onclick = () => window.redirectToQuiz(testId);
            btn.disabled = true;
            btn.className = "test-card-hover locked-test text-left bg-slate-800/30 border border-slate-700 p-4 rounded-xl transition-all duration-300 group";
            btn.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <span class="text-slate-500 font-bold text-sm">TEST ${paddedId}</span>
                    <i class="fas fa-lock text-slate-600 text-xs"></i>
                </div>
                <h3 class="text-base font-bold text-slate-500 mb-1">Coming Soon</h3>
                <div class="w-full h-1 bg-slate-800 rounded-full mt-2"></div>
            `;
            testGrid.appendChild(btn);
        }

        async function initApp() {
            try {
                if (typeof window.__initial_auth_token !== 'undefined' && window.__initial_auth_token) {
                    await signInWithCustomToken(auth, window.__initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
                
                if (auth.currentUser) {
                    currentUserId = auth.currentUser.uid;
                    listenToTestConfig(); // Listen for admin toggles
                }
                checkForResults();
            } catch (error) {
                console.error("Auth Init Error:", error);
            }
        }

        // Listen to Admin Config
        function listenToTestConfig() {
            // FIXED PATH: Added 'data' to ensure 6 segments (even number)
            const configRef = doc(db, 'artifacts', 'ssc-insight-general', 'public', 'data', 'config', 'test_status');
            onSnapshot(configRef, (docSnap) => {
                if (docSnap.exists()) {
                    activeTestsMap = docSnap.data().active_tests || {};
                    applyTestConfig();
                } else {
                    // Default: only test 1 & 2
                    activeTestsMap = { test1: true, test2: true };
                    applyTestConfig();
                }
            });
        }

        function applyTestConfig() {
            const name = document.getElementById('student-name').value.trim();
            const hasName = name.length > 0;

            for (let i = 1; i <= 30; i++) {
                const testId = `test${i}`;
                const btn = document.getElementById(`btn-${testId}`);
                if (!btn) continue;

                const isActive = activeTestsMap[testId] === true;
                
                if (isActive) {
                    // It's available, but still needs name
                    btn.classList.remove('locked-test');
                    btn.classList.add('unlocked-test');
                    // Styling updates for active tests
                    if (btn.querySelector('h3').innerText === 'Coming Soon') {
                        btn.querySelector('h3').innerText = `Practice Set ${i.toString().padStart(2,'0')}`;
                        btn.querySelector('h3').classList.add('text-white');
                        btn.querySelector('h3').classList.remove('text-slate-500');
                        btn.querySelector('.fas.fa-lock')?.remove();
                    }
                    btn.disabled = !hasName;
                    if(!hasName) btn.classList.add('opacity-50', 'cursor-not-allowed');
                    else btn.classList.remove('opacity-50', 'cursor-not-allowed');

                } else {
                    // It's strictly locked by admin
                    btn.disabled = true;
                    btn.classList.add('locked-test');
                    btn.classList.remove('unlocked-test', 'test-card-hover');
                }
            }
        }

        // Global toggle function called on input keyup
        window.toggleTestButtons = () => {
            applyTestConfig(); // Reuse the main config logic which checks name presence
        };

        // --- Result & Leaderboard Logic ---
        let allScoresLocal = [];

        function checkForResults() {
            const urlParams = new URLSearchParams(window.location.search);
            const action = urlParams.get('action');

            if (action === 'result') {
                const score = parseFloat(urlParams.get('score'));
                const total = parseInt(urlParams.get('total'));
                const accuracy = parseInt(urlParams.get('accuracy'));
                const sscScore = parseFloat(urlParams.get('sscScore'));
                const time = urlParams.get('time') || "0m 0s";
                const name = urlParams.get('name');
                const testId = urlParams.get('testId');

                // UI Switches
                document.getElementById('start-screen').classList.add('hidden');
                document.getElementById('result-screen').classList.remove('hidden');

                // Fill Data
                document.getElementById('ssc-score').innerText = sscScore.toFixed(1);
                document.getElementById('time-taken').innerText = time;
                document.getElementById('user-final-score').innerText = sscScore.toFixed(1);
                document.getElementById('user-name-display').innerText = name + " (You)";
                document.getElementById('user-time-display').innerText = time;

                // Move Promo Widgets
                const ecoWidget = document.getElementById('eco-widget');
                const ytWidget = document.getElementById('yt-widget');
                const endContainer = document.getElementById('end-screen-promos');
                if (ecoWidget) endContainer.appendChild(ecoWidget.cloneNode(true));
                if (ytWidget) endContainer.appendChild(ytWidget.cloneNode(true));

                // 1. Render Pie Chart
                const wrong = total - score;
                const ctx = document.getElementById('scoreChart').getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Correct', 'Wrong'],
                        datasets: [{
                            data: [score, wrong],
                            backgroundColor: ['#22c55e', '#ef4444'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        cutout: '75%',
                        plugins: { legend: { display: false } }
                    }
                });

                // 2. Bengali Motivation Logic
                const motTitle = document.getElementById('motivation-title');
                const motText = document.getElementById('motivation-text');
                
                if (accuracy >= 80) {
                    motTitle.innerText = "অসাধারণ! (Excellent!)";
                    motText.innerText = "তোমার প্রস্তুতি খুবই ভালো। এভাবে চালিয়ে যাও, সাফল্য আসবেই।";
                } else if (accuracy >= 50) {
                    motTitle.innerText = "ভালো প্রচেষ্টা (Good Job)";
                    motText.innerText = "তুমি ভালো করছো, কিন্তু ভোকাবুলারিতে আরও একটু জোর দিলে টপার হতে পারবে।";
                } else {
                    motTitle.innerText = "হাল ছেড়ো না (Don't Give Up)";
                    motText.innerText = "ভুল থেকেই আমরা শিখি। সময় নিয়ে পড়ো, পরের বার নিশ্চয়ই ভালো করবে।";
                }

                // 3. Save Score & Load Leaderboard
                window.finalUserScore = sscScore;
                saveScoreToFirestore(name, sscScore, testId, time);
                setupLeaderboardListener(testId, sscScore, time); // Pass current score for instant compare
                
                if (accuracy > 50) fireConfetti();
            }
        }

        async function saveScoreToFirestore(userName, score, testId, timeString) {
            currentAppId = testId === 'test1' ? 'ssc-insight-synonyms-test-01' : (testId === 'test2' ? 'ssc-insight-synonyms-test-02' : `ssc-insight-test-${testId}`);
            
            // Check if active before saving to prevent hacks (optional, but good)
            if (activeTestsMap[testId] === false) return; 

            const data = {
                name: userName,
                score: score,
                time: timeString, // Saving time
                userId: currentUserId,
                timestamp: new Date().toISOString()
            };
            
            // Local Optimistic update handled in listener usually, but pushed here
            if (auth.currentUser) {
                try {
                    const leaderboardRef = collection(db, 'artifacts', currentAppId, 'public', 'data', 'leaderboard');
                    await addDoc(leaderboardRef, data);
                } catch (e) {
                    console.error("Error adding score: ", e);
                }
            }
        }

        function setupLeaderboardListener(testId, userScore, userTime) {
             if (!auth.currentUser) return;
             if (unsubscribeLeaderboard) unsubscribeLeaderboard();

             currentAppId = testId === 'test1' ? 'ssc-insight-synonyms-test-01' : (testId === 'test2' ? 'ssc-insight-synonyms-test-02' : `ssc-insight-test-${testId}`);
             document.getElementById('leaderboard-title').innerText = `Live Rankings (${testId.toUpperCase()})`;

             const leaderboardRef = collection(db, 'artifacts', currentAppId, 'public', 'data', 'leaderboard');
             
             unsubscribeLeaderboard = onSnapshot(leaderboardRef, (snapshot) => {
                 const scores = [];
                 snapshot.forEach((doc) => scores.push(doc.data()));
                 allScoresLocal = scores;
                 updateLeaderboardUI(userScore, userTime);
             });
        }

        function updateLeaderboardUI(currentUserScore, currentUserTime) {
            allScoresLocal.sort((a, b) => b.score - a.score); // Sort Descending
            
            document.getElementById('participant-count-display').innerText = allScoresLocal.length.toLocaleString();
            
            // Render List
            const listContainer = document.getElementById('leaderboard-list');
            listContainer.innerHTML = '';
            
            const top50 = allScoresLocal.slice(0, 50);
            
            // Topper Logic
            if (top50.length > 0) {
                const topper = top50[0];
                
                // Update comparison bar
                const maxScore = topper.score > 0 ? topper.score : 1; // avoid div by 0
                const userScore = currentUserScore || 0;
                let pct = (userScore / maxScore) * 100;
                if (pct > 100) pct = 100; // In case user is the new topper
                if (pct < 0) pct = 0;
                
                document.getElementById('bar-your-score').style.width = `${pct}%`;
                document.getElementById('topper-time').innerText = topper.time || '--';

                // Percentile Calc
                const myRank = allScoresLocal.findIndex(s => s.userId === currentUserId && s.score === currentUserScore) + 1;
                if (myRank > 0) {
                    const total = allScoresLocal.length;
                    const percentile = ((total - myRank) / total) * 100;
                    document.getElementById('percentile-display').innerText = Math.round(percentile);
                    document.getElementById('user-rank').innerText = `#${myRank}`;
                }
            }

            // Render Rows
            top50.forEach((entry, index) => {
                const isUser = entry.userId === currentUserId && Math.abs(entry.score - currentUserScore) < 0.1; // Simple check
                const row = document.createElement('div');
                row.className = `p-3 border-b border-slate-700/50 grid grid-cols-12 items-center hover:bg-slate-800/30 transition-colors ${isUser ? 'bg-green-900/10' : ''}`;
                
                let rankDisplay = `#${index + 1}`;
                if(index === 0) rankDisplay = '<i class="fas fa-crown text-yellow-400"></i>';
                
                row.innerHTML = `
                    <div class="col-span-2 text-center text-slate-400 font-bold">${rankDisplay}</div>
                    <div class="col-span-6 text-sm text-slate-200 font-medium truncate">${entry.name} ${isUser ? '(You)' : ''}</div>
                    <div class="col-span-2 text-center text-xs text-slate-500">${entry.time || '-'}</div>
                    <div class="col-span-2 text-right text-sm font-bold text-green-400">${parseFloat(entry.score).toFixed(1)}</div>
                `;
                listContainer.appendChild(row);
            });
        }

        window.redirectToQuiz = (testId) => {
            const name = document.getElementById('student-name').value.trim();
            if(!name) { alert("Please enter your name first!"); return; }
            if(!activeTestsMap[testId]) { alert("This test is currently locked by Admin."); return; }
            window.location.href = `${testId}.html?name=${encodeURIComponent(name)}`;
        };

        window.shareTest = () => {
            const score = document.getElementById('ssc-score').innerText;
            const text = `I just scored ${score} in the SSC Insight Bengali Mock Test! Can you beat my rank? Join now!`;
            const url = window.location.origin + window.location.pathname;
            if (navigator.share) {
                navigator.share({ title: 'SSC Insight Mock Test', text: text, url: url });
            } else {
                navigator.clipboard.writeText(`${text} ${url}`);
                alert('Link copied to clipboard!');
            }
        };

        // --- Confetti ---
        function fireConfetti() {
            const container = document.getElementById('confetti-container');
            const colors = ['#4ade80', '#3b82f6', '#facc15', '#f87171'];
            for (let i = 0; i < 50; i++) {
                const c = document.createElement('div');
                c.className = 'confetti-piece';
                c.style.left = Math.random() * 100 + 'vw';
                c.style.animationDuration = (Math.random() * 3 + 2) + 's';
                c.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                c.style.animation = `fall ${Math.random() * 3 + 2}s linear forwards`;
                container.appendChild(c);
            }
        }
        
        // --- Slider & Trivia (Legacy) ---
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        function nextSlide() {
            if (slides.length === 0) return;
            slides[currentSlide].classList.remove('active');
            currentSlide = (currentSlide + 1) % slides.length;
            slides[currentSlide].classList.add('active');
        }
        if(slides.length > 0) setInterval(nextSlide, 3000);

        // --- Grammar Tips Logic (Restored) ---
        const grammarTips = [
            "One of the... এরপর Noun টি Plural হয় কিন্তু Verb টি Singular হয়।",
            "Senior, Junior, Superior, Inferior এরপর preposition 'to' বসে, 'than' বসে না।",
            "News, Innings, Mathematics, Politics - এগুলো দেখতে Plural হলেও Singular Verb নেয়।",
            "Furniture, Scenery, Information, Luggage - এগুলো সবসময় Singular হয়।",
            "Hardly/Scarcely এরপর helping verb হিসেবে had বসে এবং connectives হিসেবে when বসে।",
            "No sooner had... এরপর than বসে।",
            "Let এর পর সবসময় Objective Case (me, him, her, us) বসে।",
            "Unless মানেই 'যদি না', তাই Unless এর সাথে not বসে না।",
            "Prefer এর পর to বসে, কিন্তু Prefer... rather এর পর than বসে।",
            "Neither... nor এবং Either... or এর ক্ষেত্রে দ্বিতীয় subject অনুযায়ী verb বসে।", "Singular subject হলে verb singular হয়।", "Plural noun করতে বেশিরভাগ শব্দে s/es লাগে।", "Countable noun-এর সাথে many আর uncountable-এর সাথে much বসে।", "General meaning-এ a/an আর specific meaning-এ the ব্যবহৃত হয়।", "Rivers, seas, holy books, superlatives-এর আগে অবশ্যই the লাগে।", "এক বাক্যের মধ্যে tense mix হলে grammatical error ধরা পড়ে।", "Present perfect ব্যবহার হয় যখন past কাজের প্রভাব এখনো থাকে।", "দুইটা past action হলে যেটা আগে হয়েছে সেটা past perfect হয়।", "‘Will’ sudden decision আর ‘going to’ আগের plan বোঝায়।", "Can/could/may/might permission আর possibility দেখায়।", "If + present হলে result clause-এ will বসে।", "If + past হলে result clause-এ would বসে।", "‘Than’-এর পরে object pronoun বসে—than me, than him।", "Double comparative ভুল—more better, most best কখনো হয় না।", "Each আলাদাভাবে বোঝায় আর every group-কে বোঝায়।", "Either/Neither ব্যবহার করলে verb singular হয়।", "Between দুইজনের জন্য আর among তিন বা তার বেশি জনের জন্য।", "Very adjective-এর আগে বসে, কিন্তু much comparative-এর আগে।", "Few = প্রায় নেই, a few = কিছু আছে, the few = যতটুকু আছে সব।", "Little = প্রায় কিছুই নয়, a little = কিছুটা, the little = যতটুকু আছে সব।", "Pronoun তার আগের noun-এর number আর gender-এর সাথে match করতে হয়।", "Who subject, whom object, আর whose possession দেখায়।", "Preposition-এর কিছু fixed combination আছে—good at, interested in, prefer to।", "Do/does/did কখনো V2-এর সাথে বসে না—did + go, not did + went।", "Passive voice করতে be verb + V3 ব্যবহার করতে হয়।", "Reported speech-এ said to → told হয়।", "Reported speech-এ tense এক ধাপ পিছিয়ে যায়।", "Adverb of frequency (always, often) main verb-এর আগে বসে।", "So…that adjective-এর সাথে আর such…that noun-এর সাথে।", "Redundant words ভুল—return back, repeat again, join together ভুল।"
        ];

        function startGrammarTips() {
            const popup = document.getElementById('social-proof');
            const textElem = document.getElementById('proof-text');
            if(!popup || !textElem) return;

            function showTip() {
                const randomRule = grammarTips[Math.floor(Math.random() * grammarTips.length)];
                textElem.innerText = `জানো কি? ${randomRule}`;
                popup.classList.add('show');
                
                // Hide after 6 seconds
                setTimeout(() => {
                    popup.classList.remove('show');
                }, 6000);
            }

            // First pop-up after 2 seconds
            setTimeout(() => {
                showTip();
                // Then every 20 seconds
                setInterval(showTip, 20000); 
            }, 2000);
        }
        
        startGrammarTips();

        initApp();
    </script>
</body>
</html>

